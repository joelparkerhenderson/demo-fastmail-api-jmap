#!/bin/sh
#
# Get the user's mailbox by name.
#
# The default name is "Inbox".
#
set -euf
. "$(dirname "$(readlink -f "$0")")/unix-shell-script-kit"
command_exists_or_die curl
var_exists_or_die TOKEN
var_exists_or_die ACCOUNT

name="${1:-Inbox}"

curl \
--header "Content-Type: application/json; charset=utf-8" \
--header "Authorization: Bearer $TOKEN" \
--request POST \
--data "
{
    \"using\": [
        \"urn:ietf:params:jmap:core\", 
        \"urn:ietf:params:jmap:mail\"
    ],
    \"methodCalls\": [[
        \"Mailbox/query\", 
        {
            \"accountId\": \"$ACCOUNT\",
            \"filter\": {
                \"name\": \"$name\"
            }
        },
        \"\"
    ]]
}" \
"https://api.fastmail.com/jmap/api/"
